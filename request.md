# Accomplish - 项目需求说明书

## 0. 首要说明
本项目由人类开发者与 AI 合作开发。
本文档为整体需求文档，由开发者编辑，对 AI 只读。AI 根据本文档完成编码工作，步骤如下：
1、新增需求在[new][/new]标签之间，删除的旧需求在[del][/del]标签之间。实现两种标签内的任务内容。如果难以实现，或者需要配置外部资源，应如实回复困难所在。严禁用模拟、掩饰或替代方案造假。
2、测试变更的功能，保证任务成功。
3、完成编码后复查本次的代码更新，保证每一处代码更新都是用于实现当前步骤的需求，没有多余的改动。特别是不要随意改动页面的固定字符串。
4、最后与其它需求项对照，确保原有的功能仍然可用。

## 1. 项目愿景
本项目名为：先进加密货币示范。
创建一个极简、无服务器的静态 HTML 页面，用于运行和展示 Atomic Ownership Blockchains (AOB) 加密货币体系。该系统既是真实运行的加密货币，也承担演示和教育功能。
每一个使用者打开网页后，可以创建多个节点和多个用户账户，以及多条区块链，通过节点构成的 P2P 网络令这些区块链在账户之间改变归属。
在多个使用者同时打开网页时，各方的节点构成同一个 P2P 网络，各方的用户和区块链也能一体运行。

## 2. 核心技术架构
- **基础环境**：不使用任何前端框架（如 React/Vue），仅采用原生 HTML5 + Vanilla JS。
- **样式方案**：Tailwind CSS (CDN) + Lucide Icons。页面用浅色背景。
- **通信协议**：利用 mqtt 实现真实的 P2P 去中心化数据同步广播，实现跨网页的节点发现与数据同步。所有通信都是要经过远端传输。当多个使用者各自打开本网页，他们能够交换数据。
- **数据结构**：每条资产区块链都是独立的，通过添加支付区块改变资产的归属。接入点必须包括 'ws://test.mosquitto.org:8080'。
- **加密**：原生 Web Crypto API，用于生成公私钥、签名和校验。所有加密运算都是真实运算，不得造假。
- **存储**：浏览器本地持久化（LocalStorage），确保页面刷新后数据不丢失。

## 3. 界面与功能
### 3.1 打开页面
页面上方显示一段文字说明，介绍本项目的功能，提示使用者点击第一个按钮。
说明下方是一排四个按钮，依次是：建立网络、创建用户账户、创建区块链钞票、建立快速通道。后三个按钮为失活状态。
按钮区域下方是对象区域，有节点、账户、区块链、通道四个标签页。初始为空。
### 3.2 建立网络
使用者点“建立网络”按钮之后：
读取已保存的节点。若无，新建 30 个 Mesh 节点，每个节点用 UUID 标识。各节点通过 mqtt 发现其它节点，连接成 P2P 网络。
每个节点直接相连的邻节点为 4~7 个。过多时断开。数量不足时，应向既有的邻节点请求新的邻节点。
对象区域跳转到节点标签页，显示已建立的节点，用 d3.js 显示节点和彼此连接的情况，包括本网页上的节点和与本网页节点直接相连的外部节点。图必须与真实网络相符，不得造假。本网页节点与非本网页的节点颜色不同。
点击节点弹出此节点的详情页，其中有节点上的账户、相连的邻节点、收到的广播记录，还有广播测试区域。在广播记录中要显示完整的消息。
在广播测试区域输入一段消息并点“广播”按钮后，将此消息发送给所有邻节点，邻节点若是第一次收到这条消息，要将它转发给其它邻节点。注意控流，不要造成无限转发。
保存本地节点。删除“建立网络”按钮，激活下一个按钮。在上方说明中增加一行：网络就绪。
当多个使用者在不同的设备上打开本项目的网页，这些网页上的节点应能够彼此连接，形成一张大网。
### 3.2 创建用户账户
使用者点“创建用户账户”按钮之后：
新建一个系统账户。读取已保存的普通账户，若无，新建 10 个 普通账户，每个账户有一对公私密钥，以公钥标识账户。
账户与节点是多对多的关系，每个账户绑定三个节点，每个节点上可有多个账户。
对象区域跳转到账户标签页，显示已建立的普通账户。每个账户显示为一个方框，其中显示账户的资产总额和公钥的 Base64 的前 8 位，鼠标指上来时显示完整公钥。
点击账户弹出此账户的详情页，其中有账户所在节点、拥有的所有区块链，以及创建快速通道。可以选择当前账户所在的三个节点或者与这三个节点直接相连的其它节点（包括其它实例上的节点）上的任意其他账户，与当前账户之间创建快速通道。
保存本地普通账户。系统账户不显示，也不保存。删除“创建用户账户”按钮，激活下一个按钮。在上方说明中增加一行：用户账户就绪。
### 3.3 创建区块链钞票
使用者点“创建区块链钞票”按钮之后：
依照定义文件创建多条区块链。每条区块链表示一张钞票，代表一份固定的金额。可通过改变钞票的归属实现支付。
定义文件内容为：
--->
Define each blockchain as a banknote, with the data structure of its genesis block as: H\nS\nK, where: H is the SHA256 hash of this document (Base64); K is the public key of the super user (Base64), fixed at [系统账户的公钥]; S is the serial number, with the following correspondence to the banknote's denomination:
1-20 1
21-40 5
41-60 10
61-80 20
81-100 50
<--- 
新建的区块链归系统账户所有。系统账户通过向每条区块链上添加一个支付区块，以将这些区块链分发给普通账户。支付区块应包含：
上一区块的 ID(Base64)；
区块类型：支付区块；
时间戳；
目标账户的公钥(Base64)；
发送账户对上述数据的签名(Base64)。
创世区块的 ID 为其数据的哈希值。后面的区块都带有这条区块链的当前主人的签名，以签名为 ID(Base64)。
将所有区块链的前两个区块（创世区块和系统账户添加的支付区块）广播到每个节点，节点验证后各自保存。每个节点都有独立的存储区。
此后，所有区块链的主人都是一个普通账户。销毁系统账户。只有当前的主人有权添加区块。每个普通账户也可以通过添加支付区块将自己拥有的区块链送给他人。
对象区域跳转到区块链标签页，显示已建立的区块链。每个区块链显示为一个方框，其中显示区块链的面值和 ID 的 Base64 的前 8 位，鼠标指上来时显示完整 ID。
在区块链列表中，当前属于本地账户的区块链显示为蓝色，当前属于远端账户区块链显示为黄色，抵押进快速通道的显示为灰色。
点击区块链弹出此区块链的详情页，其中有区块链中的所有区块，和支付功能区域。
使用者可在支付功能区域指定一个目标账户，将这条区块链支付给他。打开区块链的详情页时有一个随机选中的目标账户。
支付时，同样添加支付区块并广播。
支付区块广播到所有节点，各节点能看到支付区块中接收者的公钥。如果这个公钥的账户不属于本网页，则把公钥保存下来。以后从本网页可以向这个公钥发起的支付，在选择目标的公钥时，本地账户与远端账户的显示效果有差异。
账户的私钥永远留在创建的网页上，不向外传送。
删除“创建区块链钞票”按钮，激活下一个按钮。在上方说明中增加一行：创建区块链钞票就绪。
### 3.4 建立快速通道
使用者点“创建用户账户”按钮之后：
在账户之间创建快速通道。
快速通道即论文中的 Speedy Channel，由两个账户创建一条区块链作为通道，各自将钞票区块链支付到通道区块链，换成自己在通道之内的余额。
创建快速通道的两个账户应处于同一个节点或直接相连的两个节点上。每个账户要与至少四人创建快速通道。每条快速通道是一条区块链，其根区块的内容为：
--->
Speedy Channel
[时间戳]
[账户公钥]
[节点 ID]
[账户公钥]
[节点 ID]
<--- 
其中账户公钥较小的账户在前。以根区块数据的哈希值为通道的 ID。
此后两个账户可能向通道充值，在自己的较大面值钞票上加一个抵押区块将钞票发送到通道上。抵押区块的格式与支付区块相似，区别是以通道的 ID 为接收者。
对象区域跳转到通道签页，显示已建立的通道，每个节点显示为一个方框，其中显示两个账户的 ID缩略及余额。
通道列表中要包括本地账户与其它实例上的账户之间的通道，颜色与双方均为本地节点的通道不同。
点击通道弹出此通道的详情页，其中有两个账户的余额和通道内的所有钞票，并有支付区域和支付记录。在支付区域选中通道的一个账户，输入一个数字（可以带小数），只要余额充足， 就能将金额发送给通道的另一个账户。如果两个账户不是在同一个节点，这个消息要加入节点的消息记录。这个消息只在两个节点间传送，不广播。
还可以使用级联支付。在支付区域选中支付账户后，点“级联”按钮，显示出另一账户 A2 的其它快速通道。可在这些通道中选择一个，又显示出所选通道另一端的用户 A3 的其它快速通道。每个通道要显示其成员的 ID 和双方余额。可以选择多级。最后一个选中的账户为支付的收款人。在这种情况下点支付，这条路径上的每一段通道上都有相同的金额从付款人流向收款人方向。
在级联操作时，可连接到所有通道，包括本地账户之间的、本地账户与其它实例上的账户之间的，和双方都是其它实例上的用户的。账户之间要加一个读取非本地通道的功能。
通道内支付的发起方必须是本地账户，级联中的次级参与方可以是任意实例上的账户。
提现功能：通道里的账户在余额足够的情况下，可以向通道中的一条区块链钞票上添加支付区块，交给自己或者他人。余额要作相应的扣除。
删除“创建快速通道”按钮。在上方说明中增加一行：快速通道就绪。

## 4. 界面风格
提供中、英文界面，有切换按钮。
在列表中显示的每个用户、区块链和通道都显示一个方框，应有边界。方框宽度不超过 160px。可点击的对象的 style 应有 cursor:pointer 属性。

## 5. AI 功能
在页面上，各功能模块和按钮旁边都显示一个小问号，点击弹出 AI 聊天窗口。每个问号对应一个默认问题，介绍对应功能的使用方法。弹出窗口后先回答默认问题，然后回答使用者后续的提问。回答范围包括包括本网页的功能、使用方法，以及 AOB 技术原理等。

## 6. AOB 论文核心技术要点 (Knowledge Base)
1. **原子所有权 (Atomic Ownership)**：资产即链。每一张钞票或资产都是一条独立的区块链，所有权变更通过在该资产链末尾添加由当前持有者签名的“支付区块”实现。
2. **去中心化架构**：没有中心服务器，没有全局共享状态。节点通过 P2P 协议（如 MQTT 模拟）同步资产链的最新状态。
3. **Speedy Channel (快速通道)**：一种二层扩展方案。通过在主链上抵押资产链到通道地址，实现通道内余额的即时结转。
4. **级联支付 (Cascade Payment)**：利用多个相互连接的 Speedy Channel，通过原子性的路径更新，实现跨通道的瞬时转账。
5. **双花防御**：节点在接收区块时验证其前序哈希和持有者签名。由于资产是独立的链，冲突检测仅需针对单条链进行，极大提高了并发性能。
6. **创世区块构造 (H\nS\nK)**：H=协议文档哈希，S=序列号（决定面值），K=发行者公钥。这是资产防伪的根基。

# Atomic MESH - AOB 实验室 - 项目需求说明书

## 0. 首要说明
本项目由人类开发者与 AI 合作开发。
本文档为整体需求文档，由开发者编辑，对 AI 只读。AI 根据本文档完成编码工作，步骤如下：
1、新增需求在[new][/new]标签之间，删除的旧需求在[del][/del]标签之间。实现两种标签内的任务内容。如果难以实现，或者需要配置外部资源，应如实回复困难所在。严禁用模拟、掩饰或替代方案造假。
2、测试变更的功能，保证任务成功。
3、完成编码后复查本次的代码更新，保证每一处代码更新都是用于实现当前步骤的需求，没有多余的改动。特别是不要随意改动页面的固定字符串。
4、最后与其它需求项对照，确保原有的功能仍然可用。

## 1. 项目愿景
创建一个极简、无服务器的静态 HTML 页面，用于运行和展示 Atomic Ownership Blockchains (AOB) 加密货币体系。该系统既是真实运行的加密货币，也承担演示和教育功能。
每一个使用者打开网页后，可以创建多个节点和多个用户账户，以及多条区块链，通过节点构成的 P2P 网络令这些区块链在用户之间改变归属。
在多个使用者同时打开网页时，各方的节点构成同一个 P2P 网络，各方的用户和区块链也能一体运行。

## 2. 核心技术架构
- **基础环境**：不使用任何前端框架（如 React/Vue），仅采用原生 HTML5 + Vanilla JS。
- **样式方案**：Tailwind CSS (CDN) + Lucide Icons。页面用浅色背景。
- **通信协议**：利用 mqtt 实现真实的 P2P 去中心化数据同步广播，实现跨网页的节点发现与数据同步。所有通信都是要经过远端传输。当多个使用者各自打开本网页，他们能够交换数据。
- **数据结构**：每条资产区块链都是独立的，通过添加支付区块改变资产的归属。
- **加密**：原生 Web Crypto API，用于生成公私钥、签名和校验。所有加密运算都是真实运算，不得造假。
- **存储**：浏览器本地持久化（由 Gun.js 自动处理或结合 LocalStorage），确保用户刷新后数据不丢失。

## 3. 界面与功能
### 3.1 打开页面
页面上方显示一段文字说明，介绍本项目的功能，提示用户点击第一个按钮。
说明下方是一排四个按钮，依次是：建立网络、创建用户账户、创建区块链钞票、建立快速通道。后三个按钮为失活状态。
按钮区域下方是对象区域，有节点、用户、区块链、通道四个标签页。初始为空。
### 3.2 建立网络
使用者点“建立网络”按钮之后：
读取已保存的节点。若无，新建 30 个 Mesh 节点，每个节点用 UUID 标识。各节点通过 Gun.js 发现其它节点，连接成 P2P 网络。
每个节点直接相连的邻节点为 4~5 个。过多时断开。数量不足时，应向既有的邻节点请求新的邻节点。
对象区域跳转到节点标签页，显示已建立的节点，每个节点显示为一个方框，其中显示节点 ID 和邻节点连接数量。
点击节点弹出此节点的详情页，其中有节点上的用户、相连的邻节点、收到的广播记录，还有广播测试区域。在广播记录中要显示完整的消息。
在广播测试区域输入一段消息并点“广播”按钮后，将此消息发送给所有邻节点，邻节点若是第一次收到这条消息，要将它转发给其它邻节点。注意控流，不要造成无限转发。
保存节点。删除“建立网络”按钮，激活下一个按钮。在上方说明中增加一行：网络就绪。
当多个使用者在不同的设备上打开本项目的网页，这些网页上的节点应能够彼此连接，形成一张大网。
### 3.2 创建用户账户
使用者点“创建用户账户”按钮之后：
新建一个系统用户。读取已保存的普通用户，若无，新建 30 个 普通用户，每个用户有一对公私密钥，以公钥标识用户。
用户与节点是多对多的关系，每个用户绑定三个节点，每个节点上可有多个用户。
对象区域跳转到用户标签页，显示已建立的普通用户。每个用户显示为一个方框，其中显示用户的资产总额和公钥的 Base64 的前 8 位，鼠标指上来时显示完整公钥。
点击用户弹出此用户的详情页，其中有用户所在节点、拥有的所有区块链。
保存普通用户。系统用户不显示，也不保存。删除“创建用户账户”按钮，激活下一个按钮。在上方说明中增加一行：用户就绪。
### 3.3 创建区块链钞票
使用者点“创建区块链钞票”按钮之后：
依照定义文件创建多条区块链。每条区块链表示一张钞票，代表一份固定的金额。可通过改变钞票的归属实现支付。
定义文件内容为：
--->
Define each blockchain as a banknote, with the data structure of its genesis block as: H\nS\nK, where: H is the SHA256 hash of this document (Base64); K is the public key of the super user (Base64), fixed at [超级用户的公钥]; S is the serial number, with the following correspondence to the banknote's denomination:
1-20 1
21-40 5
41-60 10
61-80 20
81-100 50
<--- 
新建的区块链归超级用户所有。超级用户通过向每条区块链上添加一个支付区块，以将这些区块链分发给普通用户。支付区块应包含：
上一区块的 ID(Base64)；
区块类型：支付区块；
时间戳；
目标用户的公钥(Base64)；
当前用户对上述数据的签名(Base64)。
创世区块的 ID 为其数据的哈希值。后面的区块都带有这条区块链的当前主人的签名，以签名为 ID(Base64)。
将所有区块链的前两个区块（创世区块和超级用户添加的支付区块）广播到每个节点，节点验证后各自保存。每个节点都有独立的存储区。
此后，所有区块链的主人都是一个普通用户。销毁超级用户。只有当前的主人有权添加区块。每个普通用户也可以通过添加支付区块将自己拥有的区块链送给他人。
对象区域跳转到区块链标签页，显示已建立的区块链。每个区块链显示为一个方框，其中显示区块链的面值和 ID 的 Base64 的前 8 位，鼠标指上来时显示完整 ID。
点击区块链弹出此区块链的详情页，其中有区块链中的所有区块，和支付功能区域。
使用者可在支付功能区域指定一个目标用户，将这条区块链支付给他。打开区块链的详情页时有一个随机选中的目标用户。
支付时，同样添加支付区块并广播。
删除“创建区块链钞票”按钮，激活下一个按钮。在上方说明中增加一行：创建区块链钞票就绪。
### 3.4 建立快速通道
（空）

## 4. 界面风格
在列表中显示的每个节点、用户和区块链都是一个方框，应有边界。可点击的对象的 style 应有 cursor:pointer 属性。
